<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta id="viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<meta name="description" content="Funkin' HTML Port" />
	<meta name="keywords" content="fnf, friday night funkin, fnf html, html port, html" />
	<title>Friday Night Funkin'</title>
	<meta property="og:locale" content="en-US" />
	<meta property="og:type" content="website" />
	<meta property="og:title" content="Funkin' HTML Port" />
	<meta property="og:description" content="Friday Night Funkin' is a rhythm game." />
	<meta name="apple-mobile-web-app-capable" content="yes">
	
	<link rel="shortcut icon" type="image/png" href="./favicon.png">

	<script type="text/javascript" src="./Funkin.js"></script>
	
	<script>
		window.addEventListener ("touchmove", function (event) { event.preventDefault (); }, { capture: false, passive: false });
		if (typeof window.devicePixelRatio != 'undefined' && window.devicePixelRatio > 2) {
			var meta = document.getElementById ("viewport");
			meta.setAttribute ('content', 'width=device-width, initial-scale=' + (2 / window.devicePixelRatio) + ', user-scalable=no');
		}
	</script>
	
	<style>
		html,body { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #000; }
		#openfl-content { width: 100%; height: 100%; }

		/* MOBILE BUTTONS */
		.touch-btn { 
			position: fixed; width: 110px; height: 110px; 
			background: rgba(255, 255, 255, 0.15); border: 3px solid #fff; border-radius: 12px; 
			display: flex; align-items: center; justify-content: center; 
			font-weight: bold; color: white; font-size: 32px; font-family: sans-serif;
			user-select: none; touch-action: manipulation; z-index: 9999;
		}
		#btn-left { left: 40px;  bottom: 150px; }
		#btn-down { left: 160px; bottom: 40px; }
		#btn-right { right: 40px;  bottom: 150px; }
		#btn-up    { right: 160px; bottom: 40px; }

		.sys-btn {
			position: fixed; left: 50%; transform: translateX(-50%);
			width: 130px; height: 50px; border: 2px solid #fff; border-radius: 8px;
			color: white; font-size: 18px; font-weight: bold; font-family: sans-serif;
			display: flex; align-items: center; justify-content: center; z-index: 9999;
		}
		#btn-esc   { top: 15px; background: rgba(150, 0, 0, 0.6); }
		#btn-enter { bottom: 15px; background: rgba(0, 150, 0, 0.6); }
	</style>
</head>
<body><script type="text/javascript">
		/* 1. FORCED LOW QUALITY & CLEAN CACHE */
		(function() {
			try {
				localStorage.clear(); // Clears any old "crash" data
				const settings = { lowQual: true, antialiasing: false, shaders: false, cacheCharacters: false };
				localStorage.setItem('PsychEngine_preferences', JSON.stringify(settings));
				localStorage.setItem('KadeEngine_settings', JSON.stringify(settings));
			} catch (e) { console.log("Memory fix error"); }
		})();

		/* 2. START THE GAME (Forcing DOM Renderer for stability) */
		// Ensure this name matches YOUR file exactly (capital F)
		lime.embed ("Funkin", "openfl-content", 0, 0, { parameters: { renderer: "dom" } });

		/* 3. BUTTON CONTROLS */
		const keys = { 
			'btn-left': { key: 'ArrowLeft', code: 37 }, 'btn-down': { key: 'ArrowDown', code: 40 }, 
			'btn-up': { key: 'ArrowUp', code: 38 }, 'btn-right': { key: 'ArrowRight', code: 39 },
			'btn-enter': { key: 'Enter', code: 13 }, 'btn-esc': { key: 'Escape', code: 27 } 
		};

		Object.keys(keys).forEach(id => {
			const btn = document.getElementById(id);
			if (btn) {
				const trigger = (t) => {
					window.dispatchEvent(new KeyboardEvent(t, {
						key: keys[id].key, keyCode: keys[id].code, which: keys[id].code,
						bubbles: true, cancelable: true
					}));
				};
				btn.addEventListener('touchstart', (e) => { e.preventDefault(); trigger('keydown'); btn.style.backgroundColor = "rgba(255, 255, 255, 0.4)"; });
				btn.addEventListener('touchend', (e) => { e.preventDefault(); trigger('keyup'); btn.style.backgroundColor = "rgba(255, 255, 255, 0.15)"; });
			}
		});

		/* 4. AUDIO WAKEUP */
		window.addEventListener('touchstart', () => {
			const ctx = window.AudioContext || window.webkitAudioContext;
			if (ctx) { const c = new ctx(); if (c.state === 'suspended') c.resume(); }
		}, {once: true});
	</script>
