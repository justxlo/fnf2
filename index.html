<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<title>Friday Night Funkin' Mobile</title>
	
	<script type="text/javascript" src="./Funkin.js"></script>
	
	<style>
		/* Basic Page Setup */
		body, html { 
			margin: 0; padding: 0; width: 100%; height: 100%; 
			overflow: hidden; background-color: #000; 
		}
		#openfl-content { width: 100%; height: 100%; }

		/* Control Button Styles */
		.ctrl {
			position: fixed;
			display: flex;
			align-items: center;
			justify-content: center;
			background: rgba(255, 255, 255, 0.1);
			border: 2px solid #fff;
			border-radius: 15px;
			color: #fff;
			font-family: sans-serif;
			font-weight: bold;
			font-size: 24px;
			user-select: none;
			touch-action: none; /* Prevents zooming/scrolling while playing */
			z-index: 1000;
		}

		/* Arrow Layout (Classic Left-Hand / Right-Hand split) */
		#left-arrow  { left: 20px;  bottom: 140px; width: 90px; height: 90px; border-color: #C24B99; }
		#down-arrow  { left: 120px; bottom: 40px;  width: 90px; height: 90px; border-color: #00FFFF; }
		#up-arrow    { right: 120px; bottom: 40px;  width: 90px; height: 90px; border-color: #12FA05; }
		#right-arrow { right: 20px;  bottom: 140px; width: 90px; height: 90px; border-color: #F9393F; }

		/* Menu Buttons */
		#enter-btn { left: 50%; transform: translateX(-50%); bottom: 30px; width: 140px; height: 50px; background: rgba(0, 200, 0, 0.3); }
		#esc-btn   { top: 20px; right: 20px; width: 80px; height: 40px; font-size: 14px; background: rgba(200, 0, 0, 0.3); }
	</style>
</head>
<body>

	<div id="openfl-content"></div>

	<div class="ctrl" id="left-arrow">L</div>
	<div class="ctrl" id="down-arrow">D</div>
	<div class="ctrl" id="up-arrow">U</div>
	<div class="ctrl" id="right-arrow">R</div>
	<div class="ctrl" id="enter-btn">ENTER</div>
	<div class="ctrl" id="esc-btn">PAUSE</div>

	<script type="text/javascript">
		// 1. Initialize Game
		lime.embed ("Funkin", "openfl-content", 0, 0, { parameters: { renderer: "canvas" } });

		// 2. Input Mapping
		const keyMap = {
			'left-arrow':  { key: 'ArrowLeft',  code: 37 },
			'down-arrow':  { key: 'ArrowDown',  code: 40 },
			'up-arrow':    { key: 'ArrowUp',    code: 38 },
			'right-arrow': { key: 'ArrowRight', code: 39 },
			'enter-btn':   { key: 'Enter',      code: 13 },
			'esc-btn':     { key: 'Escape',     code: 27 }
		};

		// 3. Attach Listeners
		Object.keys(keyMap).forEach(id => {
			const el = document.getElementById(id);
			const k = keyMap[id];

			const trigger = (type, active) => {
				const event = new KeyboardEvent(type, {
					key: k.key, keyCode: k.code, which: k.code,
					bubbles: true, cancelable: true, composed: true
				});
				window.dispatchEvent(event);
				// High-intensity visual feedback
				el.style.backgroundColor = active ? "rgba(255, 255, 255, 0.5)" : "rgba(255, 255, 255, 0.1)";
			};

			el.addEventListener('touchstart', (e) => { e.preventDefault(); trigger('keydown', true); });
			el.addEventListener('touchend',   (e) => { e.preventDefault(); trigger('keyup', false); });
		});

		// 4. iOS/Mobile Audio Unlock
		window.addEventListener('touchstart', () => {
			const ctx = window.AudioContext || window.webkitAudioContext;
			if (ctx) { const c = new ctx(); if (c.state === 'suspended') c.resume(); }
		}, {once: true});
	</script>
</body>
</html>
